<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HsuDDfps 麥塊伺服器資訊</title>
  <link rel="icon" href="Minecraft_Icon.png" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg: #f7f5ff;
      --bg-accent: #ede9ff;
      --glass: rgba(255,255,255,0.6);
      --text: #2b2240;
      --muted: #6f6790;
      --primary: #b9a7ff;     /* 淺紫主色 */
      --primary-strong:#7f69ff;
      --ok: #2ecc71;
      --bad:#ff5c7a;
      --warn:#f1c40f;
      --chip:#e9e4ff;
      --shadow: 0 20px 60px rgba(95,67,200,.15);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI",
                   "Noto Sans TC","PingFang TC","Microsoft JhengHei", Roboto, "Helvetica Neue", Arial, sans-serif;
      color:var(--text);
      background: var(--bg) no-repeat center/cover fixed url('Index_BG.jpg');
    }
    .backdrop{
      position:fixed; inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.5), rgba(255,255,255,.3));
      backdrop-filter: blur(6px);
    }
    .page{
      position:relative;
      min-height:100%;
      display:grid;
      place-items:center;
      padding: 24px;
    }
    .hud{
      position: fixed;
      top: 18px; left: 18px; right: 18px;
      display:flex; align-items:center; justify-content:space-between;
      gap: 12px;
      opacity:0; transform: translateY(-8px);
      animation: fadeDown .7s ease .15s forwards;
    }
    .hud .pill{
      padding:10px 14px;
      border-radius: 999px;
      background: var(--glass);
      box-shadow: var(--shadow);
      display:flex; align-items:center; gap:10px;
      border: 1px solid rgba(127,105,255,.25);
    }
    .hud .label{ color: var(--muted); font-weight:600; letter-spacing:.3px }
    .hud .time{ font-variant-numeric: tabular-nums; font-weight:700 }
    .card{
      width:min(920px, 100%);
      background: rgba(40, 30, 70, 0.75);
      border: 1px solid rgba(127,105,255,.35);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 26px;
      transform: translateY(16px) scale(.985);
      opacity:0;
      animation: rise .8s cubic-bezier(.2,.75,.2,1) .1s forwards;
    }
    .head{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      border-bottom:1px dashed rgba(127,105,255,.35);
      padding-bottom: 18px; margin-bottom: 18px;
    }
    .title{
      display:flex; align-items:center; gap:14px;
    }
    .dot{
      width:12px; height:12px; border-radius:50%;
      box-shadow: 0 0 0 4px rgba(255,255,255,.6) inset;
    }
    .status{
      display:flex; align-items:center; gap:10px;
      padding:8px 12px; border-radius:999px;
      background: var(--chip); color: var(--text);
      font-weight:700; letter-spacing:.3px;
    }
    .srv{
      font-size: 1.25rem; font-weight: 800;
      letter-spacing:.3px;
    }
    .muted{ color: var(--muted) }
    .grid{
      display:grid; gap:14px;
      grid-template-columns: repeat(12, 1fr);
    }
    .box{
      background: rgba(20, 15, 40, 0.6);
      border: 1px solid rgba(127,105,255,.25);
      border-radius: 14px;
      padding: 16px;
      min-height: 60px;
    }
    .box h4{
      margin:0 0 6px; font-size:.9rem; color:#d0cfff; font-weight:700; letter-spacing:.4px
    }
    .motd{
      line-height:1.65;
      word-break: break-word;
    }
    .big{
      font-size: 1.4rem; font-weight:800; letter-spacing:.4px;
      font-variant-numeric: tabular-nums;
    }
    .row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
    .btn{
      appearance:none; border:none; cursor:pointer;
      padding: 10px 14px; border-radius: 12px;
      font-weight: 800; letter-spacing:.3px;
      background: linear-gradient(180deg, var(--primary), var(--primary-strong));
      color: white;
      box-shadow: 0 10px 30px rgba(127,105,255,.35);
      transition: transform .06s ease, filter .2s ease;
    }
    .btn:active{ transform: translateY(1px) }
    .btn.ghost{
      background: transparent; color: var(--primary-strong);
      border: 2px solid var(--primary-strong);
      box-shadow:none;
    }
    .ip{
      padding:8px 12px; border-radius: 10px;
      background: var(--bg-accent);
      font-variant-numeric: tabular-nums; font-weight:700;
    }
    .footer{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; margin-top:16px;
      color: var(--muted);
    }
    .tiny{ font-size:.9rem; }
    .spinner{
      width:16px; height:16px; border-radius:50%;
      border: 2px solid rgba(127,105,255,.35);
      border-top-color: var(--primary-strong);
      animation: spin .9s linear infinite;
    }
    .fade{ opacity:.7; transition: opacity .2s ease }
    .ok{ background: #eafaf1; border-color:#c8efd9 }
    .bad{ background: #ffebf0; border-color:#ffd0dc }
    .center{ display:flex; align-items:center; justify-content:center; gap:8px; }
    @keyframes rise{
      to{ transform:none; opacity:1 }
    }
    @keyframes fadeDown{
      to{ transform:none; opacity:1 }
    }
    @keyframes spin{
      to{ transform: rotate(360deg) }
    }
    @media (max-width:720px){
      .grid{ grid-template-columns: repeat(6, 1fr) }
    }
  </style>
</head>
<body>
  <div class="backdrop" aria-hidden="true"></div>
  <div class="page">
    <!-- HUD: 現在時間 / 上次更新 -->
    <div class="hud">
      <div class="pill">
        <span class="label">現在時間</span>
        <span id="now" class="time">—</span>
      </div>
      <div class="pill">
        <span class="label">上次更新</span>
        <span id="last" class="time">—</span>
      </div>
    </div>

    <main class="card" id="card">
      <header class="head">
        <div class="title">
          <div id="statusDot" class="dot" style="background: var(--warn)"></div>
          <div>
            <div class="srv" id="serverName">—</div>
            <div class="muted tiny">mc.hsuddfps.com</div>
          </div>
        </div>
        <div class="status" id="statusBadge">
          <div class="spinner" id="spin"></div>
          <span id="statusText">查詢中…</span>
        </div>
      </header>

      <section class="grid" aria-live="polite" aria-busy="true">
        <div class="box" style="grid-column: span 12">
          <h4>伺服器 MOTD</h4>
          <div id="motd" class="motd">—</div>
        </div>

        <div class="box ok" style="grid-column: span 6" id="playersBox">
          <h4>在線人數</h4>
          <div class="big"><span id="players">—</span></div>
        </div>

        <div class="box" style="grid-column: span 6">
          <h4>IP 位址</h4>
          <div class="row">
            <code class="ip" id="ipText">mc.hsuddfps.com</code>
            <button class="btn" id="copyBtn" type="button">複製 IP</button>
          </div>
        </div>

        <div class="box" style="grid-column: span 12">
          <h4>玩家列表</h4>
          <div id="playerList" class="tiny muted">—</div>
        </div>
      </section>

      <div class="footer">
        <div class="row tiny">
          <span>資料來源：</span>
          <a class="btn ghost tiny" href="https://api.mcsrvstat.us/3/mc.hsuddfps.com" target="_blank" rel="noopener">mcsrvstat.us</a>
        </div>
        <div class="row tiny">
          <span id="refreshState" class="muted">每 30 秒自動更新</span>
          <button class="btn ghost tiny" id="refreshBtn" type="button" title="立即重新整理">手動更新</button>
        </div>
      </div>
    </main>
  </div>

  <script>
    // ===== 可調整參數 =====
    const HOST = "mc.hsuddfps.com";
    const API  = `https://api.mcsrvstat.us/3/${HOST}`;
    const REFRESH_MS = 30_000;
    const TIMEZONE = "Asia/Taipei"; // 固定台北時間

    // ===== 小工具：時間格式 YYYY/MM/DD HH:MM (24h) =====
    const fmt = new Intl.DateTimeFormat("zh-Hant", {
      timeZone: TIMEZONE,
      year: "numeric", month: "2-digit", day: "2-digit",
      hour: "2-digit", minute: "2-digit", hour12: false
    });
    function formatYMDHM(d){
      // Intl 會輸出 "2025/09/24 14:05" 類似格式（已是 24h）
      // 但為確保斜線與空格一致，用 formatToParts 組裝
      const parts = fmt.formatToParts(d).reduce((acc,p)=> (acc[p.type]=p.value, acc), {});
      return `${parts.year}/${parts.month}/${parts.day} ${parts.hour}:${parts.minute}`;
    }

    // ===== DOM =====
    const $ = (sel)=>document.querySelector(sel);
    const nowEl   = $("#now");
    const lastEl  = $("#last");
    const statDot = $("#statusDot");
    const statTxt = $("#statusText");
    const spinEl  = $("#spin");
    const nameEl  = $("#serverName");
    const motdEl  = $("#motd");
    const playersEl = $("#players");
    const playersBox = $("#playersBox");
    const ipEl    = $("#ipText");
    const listEl  = $("#playerList");
    const refreshBtn = $("#refreshBtn");
    const refreshState = $("#refreshState");
    const copyBtn = $("#copyBtn");

    // ===== 時鐘 =====
    function tickClock(){
      nowEl.textContent = formatYMDHM(new Date());
    }
    setInterval(tickClock, 1000);
    tickClock();

    // ===== 複製 IP =====
    copyBtn.addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(HOST);
        copyBtn.textContent = "已複製！";
        setTimeout(()=> copyBtn.textContent = "複製 IP", 1200);
      }catch{
        alert("無法複製，請手動選取。");
      }
    });

    // ===== 取得狀態 =====
    let timer = null;
    async function fetchStatus(manual=false){
      // UI: loading 狀態
      spinEl.style.display = "inline-block";
      statTxt.textContent = "更新中…";
      refreshBtn.disabled = true;
      refreshState.textContent = manual ? "正在更新…" : "每 30 秒自動更新";

      try{
        const res = await fetch(API, { cache: "no-store" });
        const data = await res.json();

        // 伺服器名稱
        const sName = data.hostname || data.debug?.ipinsrv || HOST;
        nameEl.textContent = sName;

        // 狀態
        const online = !!data.online;
        const dotColor = online ? getComputedStyle(document.documentElement).getPropertyValue('--ok') : getComputedStyle(document.documentElement).getPropertyValue('--bad');
        statDot.style.background = online ? "var(--ok)" : "var(--bad)";
        statTxt.textContent = online ? "線上" : "離線";

        // MOTD：若有提供 HTML（含彩色字元），否則使用 clean/raw
        const motdHtml = data.motd?.html?.join("<br>") ?? null;
        if(motdHtml){
          motdEl.innerHTML = motdHtml;
        }else{
          const motdText = data.motd?.clean?.join("\n") ?? data.motd?.raw?.join("\n") ?? "—";
          motdEl.textContent = motdText;
        }

        // 玩家
        const count = data.players?.online ?? 0;
        const max   = data.players?.max ?? 0;
        playersEl.textContent = online ? `${count} / ${max || "?"}` : "—";
        playersBox.classList.toggle("ok", online);
        playersBox.classList.toggle("bad", !online);

        // 玩家列表
        const list = data.players?.list;
        if(online && Array.isArray(list) && list.length){
          listEl.textContent = list.join(", ");
          listEl.classList.remove("muted");
        }else{
          listEl.textContent = online ? "目前無公開玩家列表" : "伺服器離線";
          listEl.classList.add("muted");
        }

        // IP 顯示
        ipEl.textContent = HOST;

        // 更新時間
        const now = new Date();
        lastEl.textContent = formatYMDHM(now);
      }catch(e){
        statDot.style.background = "var(--warn)";
        statTxt.textContent = "更新失敗";
        motdEl.textContent = "無法取得資料，請稍後再試。";
        playersEl.textContent = "—";
        listEl.textContent = "—";
      }finally{
        spinEl.style.display = "none";
        refreshBtn.disabled = false;
        refreshState.textContent = "每 30 秒自動更新";
      }
    }

    // 手動刷新
    refreshBtn.addEventListener("click", ()=> fetchStatus(true));

    // 首次與輪詢
    fetchStatus();
    timer = setInterval(fetchStatus, REFRESH_MS);
  </script>
</body>
</html>
